---
title: "Final Project Step2"
author: "Basava, Madhuri"
date: "2023-02-19"
output:
  pdf_document: 
    highlight: espresso
  word_document: default
bibliography: bibliography.bib
link-citations: true
---

# Introduction

Diabetes is one of the leading causes of death worldwide and especially in the USA. Nowadays more people are getting affected by diabetes. This project is to analyze different factors affecting diabetes and based on the results let people know how to prevent diabetes by altering the affecting factors.I feel that health is more than anything in the world, so this project will be useful for many people.


# Below are some of the research questions that are relevant

1)  How can we reduce diabetes cases in the future?
2)  What are the factors affecting diabetes?
3)  How much Physical activity in a certain period is needed to reduce diabetes cases?
4)  Is smoking, a direct or indirect cause of diabetes?
5)  How much BMI value range should a person have to reduce the possibility of diabetes?
6)  Does High Blood Pressure, a reason for diabetes?
7)  Are Males or Females more prone to diabetes?
8)  What age people are getting affected by diabetes more? 
9)  Is a person's heart attack/stroke has to be more careful?
10)  Will high cholesterol lead to Diabetes?
11)  Will heavy alcohol consumption lead to Diabetes?
12)  Is diabetes dependent on physical, general, or mental health? 


# Approach

* Clean the data: Firstly, I will remove the NA values from the dataset.
* Perform some transformations to tidy up the data.
* Then, Analyse the data and visualize it in the form of different graphs and 
  charts to figure out
* what are the factors which are affecting diabetes?
* plot the graphs with Diabetes on Y axis and physical activity on X-axis and analyze them.
* plot the graphs with Diabetes on Y axis and smoking on X-axis
* plot the graphs with Diabetes on Y axis and BMI on X-axis
* plot the graphs with Diabetes on Y axis and HighBP on X-axis
* plot the graphs with Diabetes on Y axis and Sex on X-axis
* plot the graphs with Diabetes on Y axis and Age on X-axis
* plot the graphs with Diabetes on Y axis and HeartDiseaseorAttack on X-axis
* plot the graphs with Diabetes on Y axis and HighChol on X-axis
* plot the graphs with Diabetes on Y axis and HvyAlcoholConsump on X-axis
* plot the graphs with Diabetes and physical, general, or mental health
* Finally provide useful analysis for people who can change their 
  lifestyle to reduce Diabetes cases.


# How your approach addresses (fully or partially) the problem.
The analysis gives us the idea of which factors are more likely to cause diabetes and share the results with everyone, so that people will change their lifestyles accordingly to reduce diabetes problems in the future.


# Data  (Minimum of 3 Datasets - but no requirement on number of fields or rows)
3 data sets  chosen for this project are from Kaggle site.

* diabetes_012_health_indicators_BRFSS2015.xlsx
* diabetes_binary_5050split_health_indicators_BRFSS2015.xlsx
* diabetes_binary_health_indicators_BRFSS2015.xlsx

The purpose of the data is to analyze the factors/predictors affecting Diabetes. The data was collected from the year 2015. The  original data has 22 columns in each data set many thousands of rows/records. 
There were no missing data. I took 50 rows/records from each dataset and combined them into one dataset by binding the rows 
which now have 150 rows/records.

# Required Packages

The important packages needed for this project are  

* realxl -- to read the excel data files.
* dplyr -- to analyze/transform the data using GroupBy, Summarize, Mutate, Filter, Select, and Arrange
* tidyr -- to tidy data to make the data more consistent 
* ggplot2 -- for visualizing the different factors affecting diabetes.
* pheatmap -- to draw a heatmap of our correlation table
* psych --  to derive descriptive statistics for a data set 

# Plots and Table Needs

Below are the Plots and tables used in this project: 

* histograms
* bar graphs
* heatmaps
* scatterplots
* boxplots

# Questions for future steps

I do not know how to graph using heatmaps to visualize all the predictors for data analysis.

##  Diabetes Indicator Project
## Set the working directory to the root of your DSC 520 directory
```{r}
setwd("C:/MadhuriDocs/MSInDataScience/DSC520RCourse3/Week8/project_data/Health")
getwd()
```



## Load the dataset 1 

```{r}
library(readxl)
excel_sheets('diabetes_indicator.xlsx')
diabetes_indicator_df <- read_excel('diabetes_indicator.xlsx',  sheet='Sheet1')
head(diabetes_indicator_df)


```

#rename the "Diabetes_012" column to "Diabetes" column to match columns with other dataframes
```{r}
names(diabetes_indicator_df)[names(diabetes_indicator_df) == "Diabetes_012"] <- "Diabetes"
head(diabetes_indicator_df)
```



```{r}
summary(diabetes_indicator_df)
```

```{r}
library("psych")
describe(diabetes_indicator_df)
```


## Load the dataset 2
```{r}
excel_sheets('diabetes_indicator.xlsx')
diabetes_indicator_5050split_df <- read_excel('DiabetesIndicator_5050split.xlsx',  sheet='Sheet1')
head(diabetes_indicator_5050split_df)


```

#rename the "Diabetes_binary" column to "Diabetes" column to match columns with other dataframes
```{r}
names(diabetes_indicator_5050split_df)[names(diabetes_indicator_5050split_df) == "Diabetes_binary"] <- "Diabetes"
head(diabetes_indicator_5050split_df)
```



```{r}
summary(diabetes_indicator_5050split_df)
```

```{r}
describe(diabetes_indicator_5050split_df)
```

## Load the dataset 3 

```{r}
excel_sheets('diabetes_indicator.xlsx')
diabetes_binary_df <- read_excel('diabetes_binary.xlsx',  sheet='Sheet1')
head(diabetes_binary_df)


```


## Data importing and cleaning steps are explained in the text and follow a logical process.  Outline your data preparation and cleansing steps.
## I have followed a step by step process 
## 1) Rename the "Diabetes_binary" column to "Diabetes" column to match columns with other dataframes. 
## 2) Combined the 3 dataframes into one data frame and
## 3) Omit the data with Na values.
## 4) Remove the outliers.



## STEP 1: Rename the "Diabetes_binary" column to "Diabetes" column to match columns with other dataframes
```{r}
names(diabetes_binary_df)[names(diabetes_binary_df) == "Diabetes_binary"] <- "Diabetes"
head(diabetes_binary_df)
```

```{r}
summary(diabetes_binary_df)
```
```{r}
describe(diabetes_binary_df)

```

## STEP 2: Bind all the three datasets into one dataset

```{r}
library(dplyr)
diabetes_df <- bind_rows(diabetes_indicator_df, diabetes_indicator_5050split_df, diabetes_binary_df)
head(diabetes_df)
```




```{r}
summary(diabetes_df)
```

```{r}
describe(diabetes_df)

```


##Look at the data
```{r}
library(tidyverse)
glimpse(diabetes_df)
```


## STEP 3: Omit the data with Na values.

```{r}
na.omit(diabetes_df)
```


Here there are no NA values in the data


##STEP 4: Remove the outlierts


## Analyze how Diabetes depends on BMI 

```{r}

# Create a Histogram of the BMI variable using the ggplot2 package.

library(ggplot2)
ggplot(diabetes_df,aes(BMI)) + geom_histogram(bins = 15)
```


```{r}
## remove the outliers
x <- diabetes_df$`BMI`                                             # Print data

x_out_rm <- x[!x %in% boxplot.stats(x)$out]    # Remove the outliers

length(x) - length(x_out_rm)                   # Count the removed observations


```


## Create boxplot without outliers

```{r}
boxplot(x_out_rm)


```

## With a clean dataset, show what the final data set looks like. However, do not print off a data frame with 200+ rows; show me the data in the most condensed form possible.


```{r}
head(diabetes_df)
```
## What do you not know how to do right now that you need to learn to import and cleanup your dataset?

## Now, I do not know how to show a data frame after the outliers are removed.I need to learn it.


## I just tried to figure it out an created a dataframe by removing outliers.
## Removing outlier data from data frame
```{r}
diabetes_df <- diabetes_df[(diabetes_df$`BMI` %in% x_out_rm ),]
head(diabetes_df)
```

```{r}
summary(diabetes_df)
```


## Discuss how you plan to uncover new information in the data that is not self-evident.
## I will use different functions like groupby and summerize to calculate the average BMI to analyze how much BMI should be maintained by an individual to avoid Diabetis.


## Using GroupBy function from dplyr package to group by Diabetes

```{r}
library(dplyr)

diabetes_df %>% group_by(Diabetes) %>% summarize(AvgBMI = mean(`BMI`))
```

0 = no diabetes 1 = prediabetes 2 = diabetes
So, based on the above analysis, the BMI should be maintained around 27.7 in order to reduce the chances of Diabetes.




## What are different ways you could look at this data to answer the questions you want to answer?
## I try to use different functions and fugure out the averages in order to analyze the data and find the answers.


## Do you plan to slice and dice the data in different ways, create new variables, or join separate data frames to create new summary information? Explain.
## Yes i plan to slice and dice the data in different ways, create new variables, or join separate data frames to create new summary information as shown in the above example on BMI.
##I combined the 3 data sets into one. sliced the data to remove outliers.  Create a new variable on average BMI(AvgBMI) and summarize it. 

## How could you summarize your data to answer key questions?
## Based on the summarized values on Average BMI , It should be maintained around 27.7 in order to reduce the chances of Diabetes.

## What types of plots and tables will help you to illustrate the findings to your questions? Ensure that all graph plots have axis titles, legend if necessary, scales are appropriate, appropriate geoms used, etc.).
## Scatter plots, Histograms and boxplots are used to visualize the data.

```{r}
ggplot(diabetes_df,aes(BMI)) + geom_histogram(bins = 15) +
labs(
    title = "Histogram of Diabetis 2015 Survey Data",
    x = "Diabetis",
    y = "count"
  )

```

```{r}
ggplot(diabetes_df, aes(BMI, Diabetes)) + geom_point() +
labs(
    title = "Scatter Plot of Diabetis 2015 Survey Data",
    x = "BMI",
    y = "Diabetis"
  )
```


## What do you not know how to do right now that you need to learn to answer your questions?
## I do not know how to use heatmaps to analyze the different variables at once to answer my questions.

##  Do you plan on incorporating any machine learning techniques to answer your research questions? Explain.
## As my data has all continuous variables, I plan to use Linear Reggession Machine learning Technique to predict the probabilitiy of Diabetis.


```{r}
diabetis_model <- lm(Diabetes~., data=diabetes_df)
diabetis_model
```

```{r}
summary(diabetis_model)
```


## Creating predictions using `predict()`


```{r}
predicted_df <- data.frame(Diabetes = predict(diabetis_model, diabetes_df), BMI = diabetes_df$BMI, HeartDiseaseorAttack = diabetes_df$HeartDiseaseorAttack, Fruits = diabetes_df$Fruits, Age = diabetes_df$Age, Sex = diabetes_df$Sex)
head(predicted_df)
```

## Some additional questions you may want to consider asking yourself as you work through this section of the project:

## What features could you ﬁlter on?
## Filtered on BMI to remove the outliers from the dataframe.

## How could arranging your data in different ways help?
## Arranging the data for example in descending order of BMI can understand more about the data

```{r}
diabetes_df  %>% arrange(desc(BMI))
```


## Can you reduce your data by selecting only certain variables?
## Yes,we can reduce the data by selecting the variables which are relavant for our analysis. 

```{r}
diabetes_df  %>% select(Diabetes, BMI, HeartDiseaseorAttack, Fruits, Age, Sex)  %>% arrange(desc(BMI))
head(diabetes_df)
```


##  Could creating new variables add new insights?

## Yes, creating new variables can add new insights, for example creating avgBMI variable from BMI could let us understand the data even more

```{r}
diabetes_df %>% group_by(Diabetes) %>% summarize(AvgBMI = mean(`BMI`))
```



## Could summary statistics at different categorical levels tell you more?
## Yes, summary statistics at different categorical levels can tell us more. For example, if we analize with  Diabetes as categorical variable with 0 = no diabetes 1 = prediabetes 2 = diabetes
## based on the above analysis, the BMI should be maintained around 27.2 in order to reduce the chances of Diabetes.



## How can you incorporate the pipe (%>%) operator to make your code more efﬁcient?
## Pipe operator can help in many ways, for example select some variables to reduce the data for better analysis. or  it can be used for group_by() and summerize fuctions as in the above examples.



## Furthur analysis will be done on other predictors



# References

*[Datasets from Kaggle website](https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset)*
